# zk-llvm-ir
Llvm-ir to zk-circuit converter proof of concept. 

## Repository structure
The repository consists of several folders, the structure of which should be a good explanations of what the project intends to do.

### stylus-contract
A simple contract written using the [cargo-stylus](https://github.com/OffchainLabs/cargo-stylus) ecosystem.
The contract has one [function](./stylus-contract/src/lib.rs) that mocks a hashing process.

```rust
pub fn mock_check(&self, number: u32) -> bool {
    // using `wrapping_mul` and `unchecked_add` simplifies the IR
    let x = number.wrapping_mul(number);
    let y = unsafe { x.unchecked_add(19) }.wrapping_mul(10);

    y == 1000
}
```
This is the function whose IR we'll analyze. 

### analysis
A Rust binary that takes the IR dumped from the stylus contract and transforms it to a [circom](https://docs.circom.io/) circuit.

### circuit
This is the [circom](https://docs.circom.io/) project that is the product of the IR analysis.

## Running the modules

Running the project is a multi-step process. Most of the steps are saved in the repo, and running first steps may be skipped.

### Dependencies

Running the project will require several dependencies. 

- [Rust](https://www.rust-lang.org/) - `stylus-contract` and `analysis` are both Rust projects.
- [cargo-stylus](https://github.com/OffchainLabs/cargo-stylus?tab=readme-ov-file#installing-with-cargo) - contract framework written in Rust required for `stylus-contract`
- [LLVM](https://llvm.org/docs/GettingStarted.html) - some of the dependencies in `analysis` rely on the system installation of LLVM (version 18).
- [opt](https://llvm.org/docs/CommandGuide/opt.html) - LLVM optimizer. Used to strip some debug info from the IR. Should be a part of your LLVM installation.
- [circom](https://docs.circom.io/getting-started/installation/) - circuit compiler required to compile the code generated by `analysis`. Make sure to install all the dependencies listed on the installation page.

### Dumping the IR

To dump the IR of the `mock_check` function:
```bash
cd stylus-contract
./dump_ir.sh
```
This will produce the `stylus_contract.ll` file with the LLVM IR for your project in the current directory.

### Generating the circom code 

Execute the following from the root directory:
```bash
cd analysis
cargo run -- --ir ../stylus-contract/stylus_contract.ll -f mock_check -o ../circuit/mock_check.circom
```
This will take the previously dumped IR, find a mock_check function, and generate the circom code for it in the `circuit` directory.

### Compiling the circuit

Execute the following from the root directory
```bash
cd circuit
circom mock_check.circom --r1cs --wasm --sym --c
```



